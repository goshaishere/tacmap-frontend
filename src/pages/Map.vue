<template>
  <div class="page-container">
    <v-container fluid class="pa-0 pa-md-4">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
      <v-row class="mb-4">
        <v-col cols="12">
          <div class="d-flex flex-column flex-sm-row align-start align-sm-center justify-space-between gap-4">
              <div class="d-flex flex-column">
                <h1 class="text-h4 text-on-surface mb-2">
              <v-icon class="me-3">mdi-map</v-icon>
              –¢–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞
            </h1>
                <div class="text-caption text-medium-emphasis">
                  üìä {{ mapStore.markers.length }} –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ –±–∞–∑–µ ‚Ä¢ {{ nativeMarkers.size }} –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–µ
                </div>
              </div>
            <div class="d-flex flex-nowrap align-center gap-2 overflow-x-auto" style="min-width:0;">
              <v-btn 
                color="accent" 
                variant="outlined" 
                prepend-icon="mdi-layers"
                @click="showLayers = !showLayers"
                size="small"
              >
                –°–ª–æ–∏
              </v-btn>
              <v-btn 
                color="accent" 
                variant="outlined" 
                prepend-icon="mdi-magnify"
                @click="showSearch = !showSearch"
                size="small"
              >
                –ü–æ–∏—Å–∫
              </v-btn>
              <v-btn 
                color="accent" 
                variant="outlined" 
                prepend-icon="mdi-ruler"
                @click="showMeasurements = !showMeasurements"
                size="small"
              >
                –ò–∑–º–µ—Ä–µ–Ω–∏—è
              </v-btn>
              <v-btn 
                color="error" 
                variant="outlined" 
                prepend-icon="mdi-delete"
                @click="resetMapData"
                size="small"
                title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã"
              >
                –°–±—Ä–æ—Å
              </v-btn>
              <v-btn 
                color="success" 
                variant="outlined" 
                prepend-icon="mdi-plus"
                @click="addTestMarker"
                size="small"
                title="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä"
              >
                –¢–µ—Å—Ç
              </v-btn>
              <v-btn 
                color="info" 
                variant="outlined" 
                prepend-icon="mdi-refresh"
                @click="reloadAllMarkers"
                size="small"
                title="–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã"
              >
                –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
              </v-btn>
              <v-btn 
                color="warning" 
                variant="outlined" 
                prepend-icon="mdi-magnify"
                @click="checkAllMarkers"
                size="small"
                title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã"
              >
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
              </v-btn>
              <v-btn 
                color="error" 
                variant="outlined" 
                prepend-icon="mdi-refresh-circle"
                @click="forceReloadMap"
                size="small"
                title="–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã"
              >
                –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É
              </v-btn>
              <v-btn 
                color="secondary" 
                variant="outlined" 
                prepend-icon="mdi-bug"
                @click="diagnoseMapState"
                size="small"
                title="–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–∞—Ä—Ç—ã"
              >
                –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
              </v-btn>
            </div>
          </div>
        </v-col>
      </v-row>
      <v-row class="adaptive-map-wrapper-row">
        <v-col cols="12" class="adaptive-map-wrapper-col">
            <CustomYandexMap />
        </v-col>
      </v-row>
    </v-container>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { useMapStore } from '../store/map.js'
import CustomYandexMap from '../components/CustomYandexMap.vue'

const mapStore = useMapStore()
const nativeMarkers = ref(new Map())
</script>

<style scoped>
.adaptive-map-wrapper-row {
  margin-top: 0px !important;
}

.adaptive-map-wrapper-col {
  padding-top: 0px !important;
  padding-bottom: 0px !important;
}
</style> 